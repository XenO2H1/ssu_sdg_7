<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTrack - Energy Saver</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Added a subtle, fluid gradient background */
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.85); /* Slightly transparent cards */
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            /* Enhanced transition for a fluid feel */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card:hover {
            /* Added a subtle lift effect on hover */
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .btn-primary {
            background-color: #22c55e; /* Vibrant green */
            color: white;
            font-weight: 600;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px 0 rgb(0 118 255 / 10%);
        }
        .btn-primary:hover {
            background-color: #16a34a; /* Darker green on hover */
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgb(0 118 255 / 20%);
        }
        /* Custom styles for form inputs for a cleaner look */
        .form-input {
             background-color: #f8fafc;
             border-color: #e2e8f0;
             transition: all 0.2s ease-in-out;
        }
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }
        /* Animation for elements appearing on screen */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased text-gray-800">
    <div id="app" class="min-h-screen p-4 sm:p-6 lg:p-8">
        
        <!-- Header -->
        <header class="mb-8 max-w-xl mx-auto">
            <div class="flex justify-between items-center">
                <a href="#" class="flex items-center gap-3 group">
                    <i class="ph-bold ph-leaf text-4xl text-green-600 group-hover:animate-spin" style="animation-duration: 3s;"></i>
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">EcoTrack Saver</h1>
                </a>
            </div>
        </header>

        <main class="max-w-xl mx-auto space-y-8">
            <!-- Device Usage Input Card -->
            <section id="input-section" class="card p-6 md:p-8 fade-in-up">
                <h2 class="text-xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                    <i class="ph-bold ph-plugs-connected text-green-600"></i>
                    Log Your Daily Energy Use
                </h2>
                <p id="form-subtitle" class="text-gray-600 mb-6">Enter the devices you used today. We'll calculate your total consumption.</p>
                <form id="device-form" class="space-y-4">
                    <div id="device-list">
                        <!-- Device entries will be added here by JavaScript -->
                    </div>
                    <button type="button" id="add-device-btn" class="w-full flex items-center justify-center gap-2 py-3 px-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:bg-gray-100 hover:border-green-400 transition-all duration-300">
                        <i class="ph-bold ph-plus-circle"></i>
                        Add Another Device
                    </button>
                    <button type="submit" id="submit-btn" class="btn-primary w-full text-lg">Calculate Today's Usage</button>
                </form>
            </section>

            <!-- Results Section (Initially Hidden) -->
            <section id="results-section" class="hidden card p-6 md:p-8">
                 <h2 id="results-title" class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <i class="ph-bold ph-chart-line-up text-blue-500"></i>
                    <!-- Title updated by JS -->
                </h2>
                <div id="results-grid" class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                    <!-- Results content is dynamically generated by JS -->
                </div>
            </section>

            <!-- About Eco Track Section (New) -->
            <section class="card p-6 md:p-8 fade-in-up" style="animation-delay: 100ms;">
                 <div class="flex items-start gap-4">
                    <i class="ph-bold ph-info text-5xl text-blue-500 flex-shrink-0 mt-1"></i>
                    <div>
                        <h2 class="text-xl font-bold mb-2">What is EcoTrack?</h2>
                        <p class="text-gray-700">EcoTrack helps you visualize your daily energy consumption. By becoming more aware of how much energy your devices use, you can make smarter choices that save you money and reduce your carbon footprint. Small changes, big impact!</p>
                    </div>
                 </div>
            </section>

            <!-- SDG 7 Link Card -->
            <section class="card p-6 md:p-8 bg-green-600 text-white fade-in-up" style="animation-delay: 200ms;">
                 <div class="flex items-start gap-4">
                    <i class="ph-bold ph-lightbulb text-5xl text-yellow-300 flex-shrink-0 mt-1"></i>
                    <div>
                        <h2 class="text-xl font-bold mb-2">Knowledge is Power</h2>
                        <p class="text-green-100 mb-4">Your efforts directly contribute to a global goal for a sustainable future.</p>
                        <a href="https://sdgs.un.org/goals/goal7" target="_blank" class="font-semibold text-white inline-flex items-center gap-1.5 group">
                            Learn about SDG 7 <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>
                 </div>
            </section>
        </main>
        
        <footer class="text-center mt-8">
            <button id="clear-data-btn" class="text-sm text-gray-500 hover:text-red-600 hover:underline transition">Clear Saved Data</button>
        </footer>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM ELEMENTS ---
    const deviceList = document.getElementById('device-list');
    const deviceForm = document.getElementById('device-form');
    const addDeviceBtn = document.getElementById('add-device-btn');
    const submitBtn = document.getElementById('submit-btn');
    const formSubtitle = document.getElementById('form-subtitle');
    const resultsSection = document.getElementById('results-section');
    const resultsTitle = document.getElementById('results-title');
    const resultsGrid = document.getElementById('results-grid');
    const clearDataBtn = document.getElementById('clear-data-btn');

    // --- APP STATE & CONSTANTS ---
    const WATTAGE_MAP = {
        'Fan': 25,
        'Light Bulb (LED)': 9,
        'Projector': 50,
        'AC (1.5 Ton)': 1500,
        'Computer': 200,
        'Lift': 7000,
        'TV (42" LED)': 120,
        'Refrigerator': 200,
        'Phone Charger': 5,
        'Other': 100
    };
    const COST_PER_KWH = 8; // in â‚¹
    const CO2_PER_KWH = 0.82; // in kg

    // --- CORE LOGIC ---
    
    // Animate numbers counting up for a fluid feel
    function animateValue(element, start, end, duration, prefix = '', suffix = '') {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const value = progress * (end - start) + start;
            element.textContent = `${prefix}${value.toFixed(2)}${suffix}`;
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    // Function to update the UI based on whether there's previous data
    function initializeUI() {
        const yesterdayKWh = localStorage.getItem('yesterdayKWh');
        if (yesterdayKWh) {
            submitBtn.textContent = "Calculate Today's Savings";
            formSubtitle.innerHTML = `Let's see how you did today! Yesterday's usage was <span class="font-bold text-green-600">${yesterdayKWh} kWh</span>.`;
        } else {
            submitBtn.textContent = "Calculate Today's Usage";
            formSubtitle.textContent = "Enter the devices you used today. We'll calculate your total consumption.";
        }
    }
    
    // Add a new device input row
    function addDeviceRow() {
        const row = document.createElement('div');
        row.className = 'device-row grid grid-cols-10 gap-2 items-center fade-in-up';
        row.style.opacity = '0'; // Start invisible for animation

        const selectOptions = Object.keys(WATTAGE_MAP).map(device => `<option value="${device}">${device}</option>`).join('');

        row.innerHTML = `
            <select class="device-type col-span-5 w-full p-2 border rounded-md form-input">
                ${selectOptions}
            </select>
            <input type="number" class="device-count col-span-2 w-full p-2 border rounded-md form-input text-center" placeholder="Qty" min="1" value="1">
            <input type="number" class="device-hours col-span-2 w-full p-2 border rounded-md form-input text-center" placeholder="Hrs" min="0" step="0.1" required>
            <button type="button" class="remove-device-btn text-gray-400 hover:text-red-500 transition-colors col-span-1 flex justify-center">
                <i class="ph-bold ph-trash text-xl"></i>
            </button>
        `;
        deviceList.appendChild(row);
    }
    
    // --- EVENT LISTENERS ---
    addDeviceBtn.addEventListener('click', addDeviceRow);
    
    // Event Delegation for remove buttons. This is more efficient.
    deviceList.addEventListener('click', (e) => {
        const removeBtn = e.target.closest('.remove-device-btn');
        if (removeBtn) {
            const rowToRemove = removeBtn.closest('.device-row');
            if (rowToRemove) {
                rowToRemove.style.animation = 'fadeOut 0.3s forwards';
                setTimeout(() => rowToRemove.remove(), 300);
            }
        }
    });
    
    // Handle the main form submission and calculation
    deviceForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        let totalKWhToday = 0;
        const deviceRows = document.querySelectorAll('.device-row');

        if (deviceRows.length === 0) {
            alert("Please add at least one device.");
            return;
        }

        deviceRows.forEach(row => {
            const type = row.querySelector('.device-type').value;
            const count = parseFloat(row.querySelector('.device-count').value) || 0;
            const hours = parseFloat(row.querySelector('.device-hours').value) || 0;
            const wattage = WATTAGE_MAP[type] || 0;
            totalKWhToday += (wattage * count * hours) / 1000;
        });

        const yesterdayKWh = localStorage.getItem('yesterdayKWh');

        if (yesterdayKWh) {
            // User has previous data, so calculate savings
            const savedKWh = parseFloat(yesterdayKWh) - totalKWhToday;
            const savedMoney = savedKWh * COST_PER_KWH;
            const reducedCO2 = savedKWh * CO2_PER_KWH;
            updateResultsForSavings(savedKWh, savedMoney, reducedCO2);
        } else {
            // First time user, just show today's consumption
            const costToday = totalKWhToday * COST_PER_KWH;
            const co2Today = totalKWhToday * CO2_PER_KWH;
            updateResultsForFirstTime(totalKWhToday, costToday, co2Today);
        }

        // Save today's usage for tomorrow's comparison and re-initialize UI
        localStorage.setItem('yesterdayKWh', totalKWhToday.toFixed(2));
        setTimeout(initializeUI, 100); // slight delay to allow results to show
    });

    // Clear data from localStorage
    clearDataBtn.addEventListener('click', () => {
        if(confirm("Are you sure you want to clear your saved energy data?")) {
            localStorage.removeItem('yesterdayKWh');
            initializeUI();
            resultsSection.classList.add('hidden');
            alert("Your data has been cleared.");
        }
    });

    // --- UI UPDATE FUNCTIONS ---
    function createResultCard(label, value, prefix, suffix, colorClass) {
        const card = document.createElement('div');
        card.className = `p-4 rounded-lg ${colorClass} bg-opacity-10`;
        card.innerHTML = `
            <p class="text-sm font-medium opacity-70">${label}</p>
            <p class="text-2xl lg:text-3xl font-bold result-value">0.00</p>
        `;
        const valueEl = card.querySelector('.result-value');
        animateValue(valueEl, 0, value, 1000, prefix, suffix);
        return card;
    }

    function updateResultsForSavings(kwh, money, co2) {
        resultsTitle.innerHTML = `<i class="ph-bold ph-sparkle text-yellow-500"></i> Your Savings Today!`;
        resultsGrid.innerHTML = ''; // Clear previous results
        
        const kwhCard = createResultCard(kwh >= 0 ? 'Energy Saved' : 'Energy Used More', Math.abs(kwh), '', ' kWh', kwh >= 0 ? 'text-green-600' : 'text-red-600');
        const moneyCard = createResultCard(money >= 0 ? 'Money Saved' : 'Money Spent More', Math.abs(money), 'â‚¹', '', money >= 0 ? 'text-blue-600' : 'text-red-600');
        const co2Card = createResultCard(co2 >= 0 ? 'COâ‚‚ Reduced' : 'COâ‚‚ Emitted More', Math.abs(co2), '', ' kg', co2 >= 0 ? 'text-gray-700' : 'text-red-600');
        
        resultsGrid.appendChild(kwhCard);
        resultsGrid.appendChild(moneyCard);
        resultsGrid.appendChild(co2Card);
        
        resultsSection.classList.remove('hidden');
        resultsSection.classList.add('fade-in-up');
    }

    function updateResultsForFirstTime(kwh, money, co2) {
        resultsTitle.innerHTML = `<i class="ph-bold ph-chart-bar text-green-500"></i> Today's Consumption`;
        resultsGrid.innerHTML = '';
        
        const kwhCard = createResultCard('Energy Used', kwh, '', ' kWh', 'text-green-600');
        const moneyCard = createResultCard('Estimated Cost', money, 'â‚¹', '', 'text-blue-600');
        const co2Card = createResultCard('COâ‚‚ Footprint', co2, '', ' kg', 'text-gray-700');
        
        resultsGrid.appendChild(kwhCard);
        resultsGrid.appendChild(moneyCard);
        resultsGrid.appendChild(co2Card);
        
        resultsSection.classList.remove('hidden');
        resultsSection.classList.add('fade-in-up');
    }
    
    // --- INITIALIZATION ---
    addDeviceRow(); // Start with one device row
    initializeUI(); // Set the initial state of the form
});
</script>
</body>
</html>
