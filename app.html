<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTrack - Energy Calculator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #22c55e; /* Vibrant green */
            color: white;
            font-weight: 600;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #16a34a; /* Darker green on hover */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="min-h-screen p-4 sm:p-6 lg:p-8">
        
        <!-- Header -->
        <header class="mb-8">
            <div class="max-w-xl mx-auto flex justify-between items-center">
                <a href="index.html" class="flex items-center gap-3 group">
                    <i class="ph-bold ph-leaf text-4xl text-green-600 group-hover:animate-spin"></i>
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">EcoTrack Calculator</h1>
                </a>
            </div>
        </header>

        <main class="max-w-xl mx-auto space-y-8">
            <!-- About EcoTrack Section -->
            <section id="about-section" class="card p-6 fade-in bg-gray-50">
                <h2 class="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="ph-bold ph-info text-emerald-600"></i>
                    What is EcoTrack?
                </h2>
                <p class="text-gray-600">
                    EcoTrack is your personal energy conservation assistant. By logging the devices you use each day, this calculator helps you visualize your energy savings in three key areas:
                </p>
                <ul class="list-disc list-inside text-gray-600 mt-3 space-y-1">
                    <li><span class="font-semibold">Energy Saved (kWh):</span> See the direct reduction in your electricity consumption.</li>
                    <li><span class="font-semibold">Money Saved (₹):</span> Understand the financial benefits of being energy efficient.</li>
                    <li><span class="font-semibold">CO₂ Reduction (kg):</span> Track your contribution to fighting climate change.</li>
                </ul>
                <p class="text-gray-600 mt-3">
                    Every watt saved is a step towards achieving SDG 7: Affordable and Clean Energy for all.
                </p>
            </section>

            <!-- Device Usage Input Card -->
            <section id="input-section" class="card p-6 fade-in">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i class="ph-bold ph-plugs-connected text-green-600"></i>
                    Log Device Usage
                </h2>
                <p class="text-gray-600 mb-6">Enter your device usage for today. We'll compare it against your daily average to show your savings.</p>
                <form id="device-form" class="space-y-4">
                    <div id="device-list">
                        <!-- Device entries will be added here by JavaScript -->
                    </div>
                    <button type="button" id="add-device-btn" class="w-full flex items-center justify-center gap-2 py-2 px-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:bg-gray-100 hover:border-gray-400 transition">
                        <i class="ph-bold ph-plus-circle"></i>
                        Add Another Device
                    </button>
                    <button type="submit" class="btn-primary w-full">Calculate Today's Savings</button>
                </form>
                <div class="text-center mt-4">
                    <button type="button" id="reset-data-btn" class="text-sm text-gray-500 hover:text-red-600 transition">Reset All Saved Data</button>
                </div>
            </section>

            <!-- Results Section (Initially Hidden) -->
            <section id="results-section" class="hidden card p-6 fade-in">
                 <h2 class="text-xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                    <i class="ph-bold ph-chart-line-up text-blue-500"></i>
                    Your Results
                </h2>
                <p id="results-subtitle" class="text-gray-600 mb-4 text-sm">Comparison based on your daily average usage.</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                    <div>
                        <p class="text-sm text-gray-500 font-medium">Energy Saved</p>
                        <p id="energy-saved-result" class="text-2xl font-bold text-green-600">0.00 kWh</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 font-medium">Money Saved</p>
                        <p id="money-saved-result" class="text-2xl font-bold text-blue-600">₹0.00</p>
                    </div>
                     <div>
                        <p class="text-sm text-gray-500 font-medium">CO₂ Reduction</p>
                        <p id="co2-reduced-result" class="text-2xl font-bold text-gray-700">0.00 kg</p>
                    </div>
                </div>
            </section>

            <!-- SDG 7 Link Card -->
            <section class="card p-6 bg-green-500 text-white fade-in">
                 <div class="flex items-start gap-4">
                    <i class="ph-bold ph-lightbulb text-5xl text-yellow-300 flex-shrink-0 mt-1"></i>
                    <div>
                        <h2 class="text-xl font-bold mb-2">Knowledge is Power</h2>
                        <p class="text-green-100 mb-4">Your efforts directly contribute to a global goal for a sustainable future.</p>
                        <a href="https://sdgs.un.org/goals/goal7" target="_blank" class="font-semibold text-white inline-flex items-center gap-1 hover:underline">
                            Learn about SDG 7: Affordable and Clean Energy <i class="ph-bold ph-arrow-right"></i>
                        </a>
                    </div>
                 </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM ELEMENTS ---
    const deviceList = document.getElementById('device-list');
    const deviceForm = document.getElementById('device-form');
    const addDeviceBtn = document.getElementById('add-device-btn');
    const resetDataBtn = document.getElementById('reset-data-btn');
    const resultsSection = document.getElementById('results-section');
    const energySavedResultEl = document.getElementById('energy-saved-result');
    const moneySavedResultEl = document.getElementById('money-saved-result');
    const co2ReducedResultEl = document.getElementById('co2-reduced-result');
    const resultsSubtitle = document.getElementById('results-subtitle');

    // --- APP STATE & CONSTANTS ---
    const WATTAGE_MAP = {
        'Fan': 75,
        'Light Bulb (LED)': 10,
        'Projector': 300,
        'AC (1.5 Ton)': 1500,
        'Computer': 250,
        'Lift': 5000,
        'Other': 100
    };
    const COST_PER_KWH = 8; // in ₹
    const CO2_PER_KWH = 0.82; // in kg
    const HISTORY_KEY = 'ecoTrackHistory';

    // --- INITIALIZATION ---
    function init() {
        addDeviceRow(); // Add one device row by default
    }

    // --- EVENT LISTENERS ---
    addDeviceBtn.addEventListener('click', addDeviceRow);
    deviceForm.addEventListener('submit', handleCalculation);
    resetDataBtn.addEventListener('click', handleResetData);
    deviceList.addEventListener('click', handleDeviceListClick);

    // --- DYNAMIC FORM LOGIC ---
    function addDeviceRow() {
        const row = document.createElement('div');
        row.className = 'device-row grid grid-cols-4 gap-2 items-center mb-2 fade-in';

        const selectOptions = Object.keys(WATTAGE_MAP).map(device => `<option value="${device}">${device}</option>`).join('');

        row.innerHTML = `
            <select class="device-type col-span-2 w-full p-2 border border-gray-300 rounded-md">
                ${selectOptions}
            </select>
            <input type="number" class="device-count w-full p-2 border border-gray-300 rounded-md" placeholder="Qty" min="1" value="1">
            <div class="flex items-center">
                <input type="number" class="device-hours w-full p-2 border border-gray-300 rounded-md" placeholder="Hrs" min="0" step="0.1" required>
                <button type="button" class="remove-device-btn text-red-500 hover:text-red-700 p-1 ml-1">
                    <i class="ph-bold ph-trash text-xl"></i>
                </button>
            </div>
        `;
        deviceList.appendChild(row);
    }
    
    function handleDeviceListClick(e) {
        const removeBtn = e.target.closest('.remove-device-btn');
        if (removeBtn) {
            const rowToRemove = removeBtn.closest('.device-row');
            if (rowToRemove) {
                rowToRemove.remove();
            }
            if (deviceList.children.length === 0) {
                addDeviceRow();
            }
        }
    }

    // --- NEW, ROBUST CALCULATION LOGIC ---
    function handleCalculation(e) {
        e.preventDefault();
        
        let totalKWhToday = 0;
        const deviceRows = document.querySelectorAll('.device-row');

        if (deviceRows.length === 0) return;

        deviceRows.forEach(row => {
            const type = row.querySelector('.device-type').value;
            const count = parseFloat(row.querySelector('.device-count').value) || 0;
            const hours = parseFloat(row.querySelector('.device-hours').value) || 0;
            const wattage = WATTAGE_MAP[type] || 0;
            totalKWhToday += (wattage * count * hours) / 1000;
        });

        const history = getHistory();
        const todayStr = new Date().toISOString().split('T')[0];
        
        // Exclude today's entry from the average calculation
        const pastEntries = history.filter(entry => entry.date !== todayStr);
        
        let averageKWh = 0;
        let baselineText = '';

        if (pastEntries.length > 0) {
            const totalPastKWh = pastEntries.reduce((sum, entry) => sum + entry.kwh, 0);
            averageKWh = totalPastKWh / pastEntries.length;
            baselineText = `Compared to your ${pastEntries.length}-day average of ${averageKWh.toFixed(2)} kWh.`;
        } else {
            // For first-time users, create a hypothetical baseline for a good first experience
            averageKWh = totalKWhToday * 1.15; // Assume 15% higher average
             baselineText = "This is your first entry! We've set a baseline for you.";
        }

        const savedKWh = Math.max(0, averageKWh - totalKWhToday);
        const savedMoney = savedKWh * COST_PER_KWH;
        const reducedCO2 = savedKWh * CO2_PER_KWH;

        updateResults(savedKWh, savedMoney, reducedCO2, baselineText);
        updateHistory(todayStr, totalKWhToday);
    }

    // --- DATA HANDLING ---
    function getHistory() {
        const historyJSON = localStorage.getItem(HISTORY_KEY);
        return historyJSON ? JSON.parse(historyJSON) : [];
    }

    function updateHistory(date, kwh) {
        let history = getHistory();
        const todayEntryIndex = history.findIndex(entry => entry.date === date);

        if (todayEntryIndex > -1) {
            // Update today's entry if it already exists
            history[todayEntryIndex].kwh = kwh;
        } else {
            // Add a new entry for today
            history.push({ date, kwh });
        }
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    }

    function handleResetData() {
        if (confirm("Are you sure you want to delete all your saved energy data? This action cannot be undone.")) {
            localStorage.removeItem(HISTORY_KEY);
            updateResults(0, 0, 0, "Your data has been reset.");
            resultsSection.classList.add('hidden');
        }
    }
    
    // --- UI UPDATES ---
    function updateResults(kwh, money, co2, subtitle) {
        energySavedResultEl.textContent = `${kwh.toFixed(2)} kWh`;
        moneySavedResultEl.textContent = `₹${money.toFixed(2)}`;
        co2ReducedResultEl.textContent = `${co2.toFixed(2)} kg`;
        resultsSubtitle.textContent = subtitle;
        resultsSection.classList.remove('hidden');
    }

    // --- KICKSTART THE APP ---
    init();
});
</script>
</body>
</html>

