<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTrack - Energy Savings Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to enhance the UI */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .card {
            background-color: white;
            border-radius: 1rem; /* Softer rounded corners */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .btn-primary {
            background-color: #22c55e; /* Vibrant green */
            color: white;
            font-weight: 600;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #16a34a; /* Darker green on hover */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="min-h-screen p-4 sm:p-6 lg:p-8">
        
        <!-- Header -->
        <header class="mb-8">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="ph-bold ph-leaf text-4xl text-green-600"></i>
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">EcoTrack</h1>
                </div>
                <div id="user-info" class="text-right">
                    <p class="font-semibold text-gray-700">Welcome, <span id="username-display">Guest</span>!</p>
                    <button id="logout-btn" class="hidden text-sm text-red-500 hover:underline">Log Out</button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto">
            <!-- Login/Class Selection Screen (Initially Visible) -->
            <section id="login-screen" class="card p-8 max-w-lg mx-auto text-center fade-in">
                <i class="ph-bold ph-users-three text-6xl text-green-500 mx-auto mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Join Your Department</h2>
                <p class="text-gray-600 mb-6">Select your department to track energy usage or continue as a guest.</p>
                <div class="space-y-4">
                    <select id="department-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        <option value="FET">FET</option>
                        <option value="FMS">FMS</option>
                        <option value="FOAG">FOAG</option>
                        <option value="BAMS">BAMS</option>
                        <option value="FOA">FOA</option>
                        <option value="FOHW">FOHW</option>
                        <option value="Auryveda">Auryveda</option>
                        <option value="Otsopathy">Otsopathy</option>
                    </select>
                    <button id="login-btn" class="btn-primary w-full">Select Department</button>
                    <button id="guest-btn" class="w-full text-gray-600 font-medium py-2 hover:text-green-600">Continue as Guest</button>
                </div>
            </section>

            <!-- Main Content (Initially Hidden) -->
            <div id="main-content" class="hidden fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <!-- Left Column: Input & Actions -->
                    <div class="lg:col-span-1 space-y-8">
                        <!-- Device Usage Input -->
                        <section id="input-section" class="card p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="ph-bold ph-plugs-connected text-green-600"></i>
                                Today's Device Usage
                            </h2>
                            <form id="device-form" class="space-y-4">
                                <div id="device-list">
                                    <!-- Device entries will be added here -->
                                </div>
                                <button type="button" id="add-device-btn" class="w-full flex items-center justify-center gap-2 py-2 px-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:bg-gray-100 hover:border-gray-400 transition">
                                    <i class="ph-bold ph-plus-circle"></i>
                                    Add Device
                                </button>
                                <button type="submit" class="btn-primary w-full">Calculate Savings</button>
                            </form>
                             <!-- Yesterday's Usage -->
                            <div class="mt-6">
                                <label class="flex items-center space-x-2 text-sm text-gray-700 cursor-pointer">
                                    <input type="checkbox" id="save-yesterday-checkbox" class="rounded text-green-600 focus:ring-green-500">
                                    <span>Save today's usage as yesterday's data for next time.</span>
                                </label>
                            </div>
                        </section>

                         <!-- Leaderboard & Awareness -->
                        <section class="card p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="ph-bold ph-trophy text-yellow-500"></i>
                                Department Leaderboard
                            </h2>
                            <ul id="leaderboard" class="space-y-3">
                                <!-- Leaderboard items will be populated here -->
                            </ul>
                        </section>
                    </div>

                    <!-- Right Column: Dashboard & Graph -->
                    <div class="lg:col-span-2 space-y-8">
                        <!-- Output Dashboard -->
                        <section id="dashboard-section">
                            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                                <div class="card p-5 flex items-center gap-4">
                                    <div class="bg-green-100 p-3 rounded-full">
                                        <i class="ph-bold ph-lightning text-3xl text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500 font-medium">Energy Saved Today</p>
                                        <p id="energy-saved" class="text-2xl font-bold text-gray-800">0.00 kWh</p>
                                    </div>
                                </div>
                                <div class="card p-5 flex items-center gap-4">
                                    <div class="bg-blue-100 p-3 rounded-full">
                                         <i class="ph-bold ph-currency-inr text-3xl text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500 font-medium">Money Saved Today</p>
                                        <p id="money-saved" class="text-2xl font-bold text-gray-800">₹0.00</p>
                                    </div>
                                </div>
                                <div class="card p-5 flex items-center gap-4">
                                    <div class="bg-gray-200 p-3 rounded-full">
                                        <i class="ph-bold ph-factory text-3xl text-gray-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500 font-medium">CO₂ Reduction</p>
                                        <p id="co2-reduced" class="text-2xl font-bold text-gray-800">0.00 kg</p>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Graph of Energy Usage -->
                        <section class="card p-6">
                             <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="ph-bold ph-chart-bar text-purple-600"></i>
                                This Week's Energy Usage (kWh)
                            </h2>
                            <div class="h-64 sm:h-80">
                                <canvas id="energy-chart"></canvas>
                            </div>
                        </section>
                        
                        <!-- Eco Tips & SDG 7 -->
                        <section class="card p-6 bg-green-500 text-white">
                             <div class="flex items-start gap-4">
                                <i class="ph-bold ph-lightbulb text-5xl text-yellow-300 flex-shrink-0 mt-1"></i>
                                <div>
                                    <h2 class="text-xl font-bold mb-2">Eco-Tip of the Day</h2>
                                    <p id="eco-tip" class="text-green-100 mb-4">Unplug chargers when not in use. They still draw a small amount of power, often called "vampire power."</p>
                                    <a href="https://sdgs.un.org/goals/goal7" target="_blank" class="font-semibold text-white inline-flex items-center gap-1 hover:underline">
                                        Learn about SDG 7: Affordable and Clean Energy <i class="ph-bold ph-arrow-right"></i>
                                    </a>
                                </div>
                             </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM ELEMENTS ---
    const loginScreen = document.getElementById('login-screen');
    const mainContent = document.getElementById('main-content');
    const loginBtn = document.getElementById('login-btn');
    const guestBtn = document.getElementById('guest-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const departmentSelect = document.getElementById('department-select');
    const usernameDisplay = document.getElementById('username-display');
    const addDeviceBtn = document.getElementById('add-device-btn');
    const deviceList = document.getElementById('device-list');
    const deviceForm = document.getElementById('device-form');
    const energySavedEl = document.getElementById('energy-saved');
    const moneySavedEl = document.getElementById('money-saved');
    const co2ReducedEl = document.getElementById('co2-reduced');
    const leaderboardEl = document.getElementById('leaderboard');
    const ecoTipEl = document.getElementById('eco-tip');
    const saveYesterdayCheckbox = document.getElementById('save-yesterday-checkbox');

    // --- APP STATE & CONSTANTS ---
    let currentUser = localStorage.getItem('ecoTrackUser') || 'Guest';
    let energyChart;
    const WATTAGE_MAP = { 'Fan': 75, 'Light (LED)': 15, 'Projector': 300, 'AC (1.5 Ton)': 1500, 'Computer': 200, 'Lift': 5000, 'Other': 100 };
    const COST_PER_KWH = 8; // in ₹
    const CO2_PER_KWH = 0.82; // in kg
    const LEADERBOARD_DATA = [
        { name: 'FET', savings: 12.5 },
        { name: 'FOAG', savings: 10.2 },
        { name: 'FMS', savings: 9.8 },
        { name: 'BAMS', savings: 7.1 },
        { name: 'FOHW', savings: 5.4 },
        { name: 'FOA', savings: 4.9 },
        { name: 'Auryveda', savings: 3.2 },
        { name: 'Otsopathy', savings: 2.1 },
    ];
    const ECO_TIPS = [
        "Use natural light whenever possible instead of turning on lights.",
        "Turn off lights and fans when you leave a room, even for a short time.",
        "Set your AC to 24-26°C for optimal energy efficiency.",
        "Report any flickering lights or faulty equipment, as they can consume more power.",
        "Unplug chargers when not in use. They still draw 'vampire power'."
    ];

    // --- INITIALIZATION ---
    function init() {
        checkLoginState();
        addDeviceRow(); // Add one device row by default
        renderLeaderboard();
        renderChart();
        displayRandomEcoTip();
    }

    // --- AUTH & UI TOGGLING ---
    function checkLoginState() {
        if (currentUser && currentUser !== 'Guest') {
            showMainContent(currentUser);
        } else {
            showLoginScreen();
        }
    }

    function showMainContent(username) {
        loginScreen.classList.add('hidden');
        mainContent.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
        usernameDisplay.textContent = username;
        currentUser = username;
        localStorage.setItem('ecoTrackUser', username);
    }

    function showLoginScreen() {
        loginScreen.classList.remove('hidden');
        mainContent.classList.add('hidden');
        logoutBtn.classList.add('hidden');
        usernameDisplay.textContent = 'Guest';
        currentUser = 'Guest';
        localStorage.removeItem('ecoTrackUser');
    }

    loginBtn.addEventListener('click', () => {
        const selectedDepartment = departmentSelect.value;
        showMainContent(selectedDepartment);
    });

    guestBtn.addEventListener('click', () => {
        showMainContent('Guest');
    });

    logoutBtn.addEventListener('click', () => {
        showLoginScreen();
        // Reset dashboard on logout
        updateDashboard(0, 0, 0);
    });

    // --- DYNAMIC FORM LOGIC ---
    addDeviceBtn.addEventListener('click', addDeviceRow);

    function addDeviceRow() {
        const deviceId = Date.now(); // Unique ID for the row
        const row = document.createElement('div');
        row.classList.add('device-row', 'grid', 'grid-cols-1', 'sm:grid-cols-3', 'gap-2', 'items-center', 'mb-2', 'fade-in');
        row.dataset.id = deviceId;

        const selectOptions = Object.keys(WATTAGE_MAP).map(device => `<option value="${device}">${device}</option>`).join('');

        row.innerHTML = `
            <select class="device-type w-full p-2 border border-gray-300 rounded-md">
                ${selectOptions}
            </select>
            <input type="number" class="device-count w-full p-2 border border-gray-300 rounded-md" placeholder="Qty" min="1" value="1">
            <div class="flex items-center gap-2">
                <input type="number" class="device-hours w-full p-2 border border-gray-300 rounded-md" placeholder="Hours used" min="0" step="0.1" required>
                <button type="button" class="remove-device-btn text-red-500 hover:text-red-700 p-2" onclick="removeDeviceRow(${deviceId})">
                    <i class="ph-bold ph-trash text-xl"></i>
                </button>
            </div>
        `;
        deviceList.appendChild(row);
    }
    
    // Make remove function global to be accessible from inline onclick
    window.removeDeviceRow = function(id) {
        const rowToRemove = document.querySelector(`.device-row[data-id='${id}']`);
        if(rowToRemove) {
            rowToRemove.remove();
        }
    }

    // --- CALCULATION LOGIC ---
    deviceForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        let totalKWhToday = 0;
        const deviceRows = document.querySelectorAll('.device-row');

        deviceRows.forEach(row => {
            const type = row.querySelector('.device-type').value;
            const count = parseFloat(row.querySelector('.device-count').value) || 0;
            const hours = parseFloat(row.querySelector('.device-hours').value) || 0;
            
            const wattage = WATTAGE_MAP[type] || 0;
            const kwh = (wattage * count * hours) / 1000;
            totalKWhToday += kwh;
        });

        // Get yesterday's usage
        const yesterdayKWh = parseFloat(localStorage.getItem('yesterdayKWh')) || (totalKWhToday * 1.15); // Assume 15% higher if no data

        // Calculate savings
        const savedKWh = Math.max(0, yesterdayKWh - totalKWhToday);
        const savedMoney = savedKWh * COST_PER_KWH;
        const reducedCO2 = savedKWh * CO2_PER_KWH;

        // Update UI
        updateDashboard(savedKWh, savedMoney, reducedCO2);
        updateChart(totalKWhToday);

        // Optional: Save today's usage as yesterday's for the next calculation
        if (saveYesterdayCheckbox.checked) {
            localStorage.setItem('yesterdayKWh', totalKWhToday.toFixed(2));
            alert("Today's usage has been saved for tomorrow's comparison!");
        }
    });
    
    // --- UI UPDATES ---
    function updateDashboard(kwh, money, co2) {
        energySavedEl.textContent = `${kwh.toFixed(2)} kWh`;
        moneySavedEl.textContent = `₹${money.toFixed(2)}`;
        co2ReducedEl.textContent = `${co2.toFixed(2)} kg`;
    }

    function renderLeaderboard() {
        leaderboardEl.innerHTML = '';
        LEADERBOARD_DATA.sort((a, b) => b.savings - a.savings).forEach((item, index) => {
            const li = document.createElement('li');
            li.classList.add('flex', 'justify-between', 'items-center', 'p-2', 'rounded-md');
            li.classList.toggle('bg-green-50', index % 2 === 0);
            
            const rank = index + 1;
            let icon = '';
            if (rank === 1) icon = `<i class="ph-fill ph-medal text-2xl text-yellow-400"></i>`;
            else if (rank === 2) icon = `<i class="ph-fill ph-medal text-2xl text-slate-400"></i>`;
            else if (rank === 3) icon = `<i class="ph-fill ph-medal text-2xl text-amber-600"></i>`;
            else icon = `<span class="font-bold text-gray-500 w-6 text-center">${rank}</span>`;

            li.innerHTML = `
                <div class="flex items-center gap-3">
                    ${icon}
                    <span class="font-semibold text-gray-700">${item.name}</span>
                </div>
                <span class="font-bold text-green-600">${item.savings.toFixed(1)} kWh</span>
            `;
            leaderboardEl.appendChild(li);
        });
    }

    function displayRandomEcoTip() {
        const randomIndex = Math.floor(Math.random() * ECO_TIPS.length);
        ecoTipEl.textContent = ECO_TIPS[randomIndex];
    }

    // --- CHART LOGIC ---
    function renderChart() {
        const ctx = document.getElementById('energy-chart').getContext('2d');
        const weeklyData = getWeeklyData();
        
        energyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Energy Usage (kWh)',
                    data: weeklyData.data,
                    backgroundColor: 'rgba(34, 197, 94, 0.6)',
                    borderColor: 'rgba(22, 163, 74, 1)',
                    borderWidth: 1,
                    borderRadius: 5,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#e5e7eb'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
    
    function getWeeklyData() {
        let data = JSON.parse(localStorage.getItem('weeklyEnergyData'));
        if (!data || !Array.isArray(data) || data.length !== 7) {
            // Return placeholder data if none exists
            return { data: [15, 18, 16, 20, 17, 22, 19] };
        }
        return { data };
    }

    function updateChart(todayUsage) {
        const dayOfWeek = new Date().getDay(); // Sunday = 0, Monday = 1...
        const chartIndex = (dayOfWeek === 0) ? 6 : dayOfWeek - 1;

        let weeklyData = getWeeklyData().data;
        weeklyData[chartIndex] = todayUsage;
        
        localStorage.setItem('weeklyEnergyData', JSON.stringify(weeklyData));
        
        energyChart.data.datasets[0].data = weeklyData;
        energyChart.update();
    }

    // --- KICKSTART THE APP ---
    init();
});
</script>
</body>
</html>

